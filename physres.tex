%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% AGUJournalTemplate.tex: this template file is for articles formatted with LaTeX
%
% This file includes commands and instructions
% given in the order necessary to produce a final output that will
% satisfy AGU requirements. 
%
% You may copy this file and give it your
% article name, and enter your text.
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% PLEASE DO NOT USE YOUR OWN MACROS
% DO NOT USE \newcommand, \renewcommand, or \def, etc.
%
% FOR FIGURES, DO NOT USE \psfrag or \subfigure.
% DO NOT USE \psfrag or \subfigure commands.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% All questions should be e-mailed to latex@agu.org.
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% Step 1: Set the \documentclass
%
% There are two options for article format:
%
% 1) PLEASE USE THE DRAFT OPTION TO SUBMIT YOUR PAPERS.
% The draft option produces double spaced output.
% 
% 2) numberline will give you line numbers.

%% To submit your paper:
%\documentclass[draft,linenumbers]{agujournal}
%\draftfalse

%% For final version.
\documentclass{agujournal}
\usepackage{url}
% Now, type in the journal name: \journalname{<Journal Name>}

% ie, \journalname{Journal of Geophysical Research}
%% Choose from this list of Journals:
%
% JGR-Atmospheres
% JGR-Biogeosciences
% JGR-Earth Surface
% JGR-Oceans
% JGR-Planets
% JGR-Solid Earth
% JGR-Space Physics
% Global Biochemical Cycles
% Geophysical Research Letters
% Paleoceanography
% Radio Science
% Reviews of Geophysics
% Tectonics
% Space Weather
% Water Resource Research
% Geochemistry, Geophysics, Geosystems
% Journal of Advances in Modeling Earth Systems (JAMES)
% Earth's Future
% Earth and Space Science
%
%

\journalname{Journal of Advances in Modeling Earth Systems (JAMES)}


\begin{document}

%% ------------------------------------------------------------------------ %%
%  Title
% 
% (A title should be specific, informative, and brief. Use
% abbreviations only if they are defined in the abstract. Titles that
% start with general keywords then specific terms are optimized in
% searches)
%
%% ------------------------------------------------------------------------ %%

% Example: \title{This is a test title}

%\title{Coupling physical parameterizations to high-order element-based Galerkin dynamical cores; the division of an element}

%\title{A finite-volume physics grid for coupling to element-based high-order Galerkin dynamical cores; the division of an element}

%\title{A finite-volume physics grid for coupling to spectral-element dynamical cores; the division of an element}

%\title{Physical parameterizations, their grid, and element based high-order Galerkin methods}

\title{Exploring a lower resolution physics grid in CAM-SE-CSLAM}

%% ------------------------------------------------------------------------ %%
%
%  AUTHORS AND AFFILIATIONS
%
%% ------------------------------------------------------------------------ %%

% Authors are individuals who have significantly contributed to the
% research and preparation of the article. Group authors are allowed, if
% each author in the group is separately identified in an appendix.)

% List authors by first name or initial followed by last name and
% separated by commas. Use \affil{} to number affiliations, and
% \thanks{} for author notes.  
% Additional author notes should be indicated with \thanks{} (for
% example, for current addresses). 

% Example: \authors{A. B. Author\affil{1}\thanks{Current address, Antartica}, B. C. Author\affil{2,3}, and D. E.
% Author\affil{3,4}\thanks{Also funded by Monsanto.}}

\authors{A.R. Herrington\affil{1}\thanks{Stony Brook, New York}, P.H. Lauritzen\affil{2}, S. Goldhaber\affil{2}, Mark A. Taylor\affil{3}, K.A. Reed\affil{1}}

 \affiliation{1}{School of Marine and Atmospheric Sciences, Stony Brook University, Stony Brook, New York}
 \affiliation{2}{National Center for Atmospheric Research, Boulder, Colorado, USA}
 \affiliation{3}{Sandia National Laboratories, Albuquerque, New Mexico, USA}

%% Corresponding Author:
% Corresponding author mailing address and e-mail address:

% (include name and email addresses of the corresponding author.  More
% than one corresponding author is allowed in this LaTeX file and for
% publication; but only one corresponding author is allowed in our
% editorial system.)  

% Example: \correspondingauthor{First and Last Name}{email@address.edu}

\correspondingauthor{Adam R. Herrington}{adam.herrington@stonybrook.edu}

% Example: 
% \begin{keypoints}
% \item	List up to three key points (at least one is required)
% \item	Key Points summarize the main points and conclusions of the article
% \item	Each must be 100 characters or less with no special characters or punctuation 
% \end{keypoints}

\begin{keypoints}
\item 
\item 
\item 
\end{keypoints}

%% ------------------------------------------------------------------------ %%
%
%  ABSTRACT
%
% A good abstract will begin with a short description of the problem
% being addressed, briefly describe the new data or analyses, then
% briefly states the main conclusion(s) and how they are supported and
% uncertainties. 
%% ------------------------------------------------------------------------ %%

%% \begin{abstract} starts the second page 

\begin{abstract}
\end{abstract}


%% ------------------------------------------------------------------------ %%
%
%  TEXT
%
%% ------------------------------------------------------------------------ %%

%this should be included in the next paper (physres)
%When introducing a physics grid separate from the dynamics grid the question arises of what the resolution of the physics grid should be compared to the dynamics grid. For example, Figure \ref{fig:physgrid-1d} shows physics grids with the same, coarser and finer resolution than the GLL dynamics grid. From linear stability and accuracy analysis of numerical methods, it is a common result that the shortest resolvable wavelengths are not accurately represented. Similar arguments can be made from analyzing total kinetic energy spectra \citep{S2011LNCSE}. One may therefore argue that only believable scales should be passed to the physical parameterizations \citep{LH1997MWR}, i.e. a coarser resolution physics grid. This concept was investigated in a spectral transform model by \cite{W1999T}. On the other hand, computing physics tendencies on a higher-resolution grid compared to the dynamical core may provide a better sampling of the atmospheric state, somewhat similar to the super-parameterization \citep{G2001JAS,GRL:GRL14999,SA2007ASL} and sub-columns{\footnote{\citet{gmdd-8-5041-2015} in the context of CAM}} \citep{subcolumn,JGRD:JGRD10481} concepts. This approach was taken by \cite{M2009T} in the context of vertical refinement. \cite{W2014PTRSL} found improved forecast scores by increasing the grid-point space resolution compared to the resolution in wave-number space for the spectral transform model at ECMWF. 

%Alternatively, one could combine the two ideas and compute the state of the atmosphere on a coarser resolution grid and then use sub-columns or super-parameterization. One thereby passes believable scales to the sub-grid scale model and thereby assumes that a statistical sampling, in the case of sub-columns, or a simplified cloud-resolving model, in the case of super-parameterization, provides a more accurate sub-grid-scale tendency than sampling the Galerkin basis functions over the sub-grid-scale. [Discuss \cite{W2014PTRSL}: spectral truncation and physics (physical) grid (see page 10; conclusions)]

%Separating physics and dynamics grids has been investigated in the context of spectral transform models by \citet{TELA:TELA0009}, in which the separation was performed by truncation in wavenumber space. Parts of the physical parameterizations (microphysics) were separated in \citet{JGRD:JGRD50711} and vertical grid separation was investigated in \citet{TELA:TELA394}. In this study we run all of the parameterization on the physgrid.

%In the context of spectral transform model \citet{TELA:TELA0009} held the physics forcing scale fixed while refining the horizontal resolution of the dynamical core. In the context of microphysics \citet{JGRD:JGRD50711} did a scale separation and \citet{TELA:TELA394} separated the vertical grids. While \citet{LH1997MWR} and \citet{TELA:TELA0009} separated scales truncation of the the wave transform, we here separate scales through integrating basis functions over control volumes and , contrary to \citet{JGRD:JGRD50711}, all of the physical parameterization computations are performed on the physgrid. We focus on horizontal separation of scales here.

\section{Introduction}\label{sec:intro}

Global atmospheric models fundamentally consist of two components. The dynamical core ({\em{dynamics}}), which numerically integrate the adiabatic equations of motion and tracer advection, and the physical parameterizations ({\em{physics}}), which compute the effects of diabatic and subgrid-scale processes (e.g., radiative transfer and moist convection) on the grid-scale. More out of convenience than anything else, the physics are evaluated on the dynamics grid, i.e., the physics grid and dynamics grid coincide. From linear stability and accuracy analysis of numerical methods, it is a common result that the shortest simulated wavelengths are not accurately represented by the dynamical core. Additionally, simulated downscale cascades result in an unrealistic collection of energy and/or enstrophy near the truncation scale, which may be observed from kinetic energy spectra in model simulations \citep{S2011LNCSE}. Some form of dissipation must be incorporated into models to mitigate these numerical artifacts near the grid scale \citep{JW2010LNCSE}. This numerical dissipation has no physical analogy \citep[although see][]{GMR2007}, and the grid-scale is therefore contaminated by numerous un-physical processes. The under-resolved nature of the grid-scale led \cite{LH1997MWR} to speculate whether the physics should be evaluated on a grid that is more reflective of the scales actually resolved by the dynamical core.

Experimentation with different physics grid resolutions have so far been limited to models employing the spectral transform method \citep{LH1997MWR,W1999T,W2014PTRSL}. \cite{LH1997MWR} argue that passing under-resolved states to the physics may be especially problematic in spectral transform models, since the physics are evaluated on a latitude-longitude transform grid, and contains more degrees of freedom than the spectral representation to prevent aliasing of quadratic quantities. However, \cite{LH1997MWR} indicate that the spectral truncation of the physics tendencies damps errors that may result from passing an under-resolved state to the physics, although the extent to which these errors may still be present in the model was not addressed. 

Another class of spectral-transform models evaluate the quadratic terms using semi-Lagrangian methods, which are implicitly diffusive, relaxing constraints on the resolution of the transform grid. \cite{W2014PTRSL} experimented with different transform grid resolutions and concluded that the standard high resolution quadratic grid actually improves forecast skill over the use of a lower-resolution transform grid. They suggests that increasing the resolution of the transform grid simulates a kind of sub-grid variability on the spectral state, which is thought to be under-represented in global atmospheric models \citep{S2005QJR}. This is in principle the purpose of ``super-parameterization," in which a cloud resolving model is embedded in each grid cell to simulate the requisite subgrid variability, and improves both diurnal and sub-seasonal variability in the model \citep{RKAG2003BAMS}.

After the physics tendencies are transformed into spectral space, the tendencies may be truncated at any particular wave number. \cite{W1999T} conducted a pair of convergence tests using a global spectral transform model; a conventional convergence test and one in which the spectral truncation of the physics tendencies is held fixed and the resolution of the dynamical core increased. In contrast to the realistic weather forecasts of \cite{W2014PTRSL}, \cite{W1999T} run their model to equilibrium in an idealized climate configuration. When the physics and dynamics resolutions increase together, as in more typical convergence studies, the strength of the Hadley Cell increases monotonically with resolution. This sensitivity of Hadley Cell strength to horizontal resolution is a common result of global models at hydrostatic resolutions \citep[see][and references therein]{HR2017JCLIM}. But with the truncation wave number of physics tendencies held fixed, the Hadley Cell showed very little sensitivity to dynamical core resolution, resembling the solution for which the dynamics truncation wave number is equal to that of the lower resolution physics. 

\cite{HR2017JCLIM} speculate that the results of \cite{W1999T} indicate that the scales of motion resolved by the dynamical core are aliased to the lower resolution physics. It may be worth considering that if the resolution of the dynamics is reduced in response to a coarser physics grid, then the dynamics may be no better resolved on the coarser physics grid, compared with the conventional method of evaluating the physics and dynamics at the same resolution. The results of \cite{W1999T,W2014PTRSL} do not provide evidence that a lower resolution physics grid reduces computational errors in spectral transform models, but this was seldom discussed in either study.  

Global spectral transform models, while remarkably efficient at small processor counts, do not scale well on massively parallel systems. High-order Galerkin methods are becoming increasingly popular in climate and weather applications due to their high-parallel efficiency, high-processor efficiency, high-order accuracy (for smooth problems), and geometric flexibility facilitating mesh-refinenment applications. High resolution climate simulations with NCAR's Community Atmosphere Model \citep[CAM;][]{CAM5} are typically performed using a continuous Galerkin dynamical core referred to as CAM-SE \citep[CAM Spectral Elements;][]{TES2008JPCS,DetAl2012IJHPCA,LetAl2018JAMES}. CAM-SE may be optionally coupled to a conservative, semi-Lagrangian tracer advection scheme for accelerated multi-tracer transport \citep[CAM-SE-CSLAM;][]{LTOUNGK2017MWR}. Tracer advection then evolves on an entirely separate, finite-volume grid which contains the same degrees of freedom as CAM-SE's quadrature node grid.

Element-based Galerkin methods are susceptible to grid-imprinting, and may need be considered when contemplating a particular physics grid \citep[][hereafter referred to as HL18]{HL2018MWR}. Grid imprinting manifests at the element boundaries, since the global basis is least smooth ($C^{0}$; all derivatives are discontinuous) for quadrature nodes lying on the element boundaries, and the gradients (e.g., the pressure gradient) are systematically tighter producing local extremes. Through computing the physics tendencies at the nodal points, element boundary extrema is also observed in the physics tendencies. 

HL18 has shown that through evaluating the physics on the finite-volume tracer advection grid in CAM-SE-CSLAM, element boundary noise is substantially reduced, although still problematic in regions of steep terrain, at low latitudes. Through integrating CAM-SE's basis functions over the control volumes of the finite-volume grid, element boundary extrema is additionally weighted by the $C^{\infty}$ solutions (i.e., the basis representation is infinitely smooth and all derivatives are continuous) of the element interior, and the state is smoother. Additionally, in defining an area averaged state, the finite-volume physics grid is made consistent with assumptions inherent to the physics, and is more appropriate for coupling to other model components (e.g., the land model), which is typically performed using finite-volume based mapping algorithms.

The finite-volume grid of HL18 is found through dividing the elements of CAM-SE's gnomic cubed-sphere grid with equally spaced, equi-angular coordinate lines parallel to the equi-angular element boundaries, such that there are $3\times 3$ control volumes per element (hereafter referred to as $pg3$). While a $3\times 3$ physics grid was chosen in order to have the same degrees of freedom as the dynamical core, the control volumes encompass a region of the element in which their proximity to the element boundaries are not equal. Therefore, not every control volume in an element has the same smoothness properties. This may be avoided through defining a physics grid in which the elements are instead divided into $2\times 2$ control volumes (hereafter referred to as $pg2$). The control volumes of the $pg2$ grid all have the same proximity to the element boundaries, and should mitigate the element boundary noise that remains in the $pg3$ grid, and shown in HL18.

In this study, we test the hypothesis that the coarser, $pg2$ physics grid is effective at reducing spurious noise at element boundaries, particularly over regions of rough topography. In addition, the recent trend towards running models at ever higher resolutions is an almost prohibitive computational burden. As the physics are responsible for over half of the computational cost in CAM-SE \citep{LetAl2018JAMES}, the improvement in computational performance using a coarser resolution physics grid is potentially significant. However, any advantages of using a coarser physics grid need be weighed against any potential reduction in simulation quality, e.g., possible aliasing of the resolved scales of motion by the coarser grid, as suggested by the results of \cite{W1999T}. Section \ref{sec:methods} describes the implementation of the $pg2$ grid into CAM-SE-CSLAM. Section \ref{sec:results} provides the results of a hierarchy of model configurations to identify any changes in grid imprinting, or in the overall solution, compared with the $pg3$ configuration. Section \ref{sec:conclusions} provides a discussion of the results and conclusions.

\section{Methods}\label{sec:methods}

\input{mapping.tex}

\begin{figure}[t]
\begin{center}
\noindent\includegraphics[width=30pc,angle=0]{figs/area-schematic.png}\\
\end{center}
\caption{Indice notation for the (a) $pg2$ grid, (b), $pg3$ grid and (c) their exchange grid. {\color{red}Peter - do you think you will use this figure?}}
\label{fig:area-schematic}
\end{figure}

\begin{figure}[t]
\begin{center}
\noindent\includegraphics[width=30pc,angle=0]{figs/alg-schematic.png}\\
\end{center}
\caption{Make captions stand-alone while being concise}
\label{fig:alg-schematic}
\end{figure}

%In the $pg2$ configuration, mapping the fields to and from the quadrature grid and $pg2$ grid is identical to that described in HL18. As discussed above above, in mapping to the physics grid, CAM-SE's Lagrange basis functions are integrated over the $pg2$ control volumes to provide the physics with a volume averaged state. The procedure is accurate to machine precision, conserves thermal energy and dry air mass, and is consistent (i.e., the mapping preserves a constant). The reverse mapping, from the physics grid to the quadrature grid, is done using a tensor-product Lagrange interpolation (see Appendix A in HL18). The Lagrange interpolation is consistent, conserves dry air mass ({\color{red}{Peter, is this true?}}), but does not conserve thermal energy. Errors arising from the lack of energy conservation were estimated to be small; about two orders of magnitude less than the energy dissipation due to the dynamical core alone.

%The semi-Lagrangian advection of tracers in our $pg2$ configuration is solved on the CSLAM grid. 

Preserving linear correlations in mapping to and from the CSLAM and $pg2$ grids requires additional considerations; one such problem is depicted schematically in Figure~\ref{fig:alg-schematic}. Consider a single element of CSLAM control volumes, containing only a single cell with mixing ratio $1.0$, and $0.0$ everywhere else ($m_l$; Figure ~\ref{fig:alg-schematic}a). Assume that the mixing ratios mapped to the $pg2$ grid ($m_k$; Figure~\ref{fig:alg-schematic}b) results in a negative tracer tendency from the physics ($f_k$; Figure~\ref{fig:alg-schematic}c). The non-zero values of the tendencies for $pg2$ areas overlapping CSLAM grid cells originally containing a mixing ratio of zero ($f_{k,l}$; Figure~\ref{fig:alg-schematic}d), are driven negative by the mapped tendency (Figure~\ref{fig:alg-schematic}e). Preserving linear correlations in mapping to and from grids with different degrees of freedom can not be guaranteed without additional modifications to the mapping procedure.

{\color{red}Describe algorithm here}

{\color{red}Peter -  I think the results of the terminator tests should be mentioned here. We could just put in a sentence saying it passes. But I'm assuming that if we don't use the algorithm that weights the tendency by the amount of available mixing ratio, it will fail. If that's the case, we could just do a two panel plot showing the iCLy at day 15 for with and without the algorithm.}

\subsubsection{Model Configurations}\label{sec:config}

Two model configurations using CESM2.1 (\url{https://doi.org/10.5065/D67H1H0V}) are chosen to carry out the objectives discussed in Section~\ref{sec:intro}. To test the hypothesis, that the $pg2$ grid reduces spurious grid-noise over mountainous regions, a Held-Suarez configuration \citep[$FHS94$ compset;][]{HS1994} modified to include real world topography is analyzed. HL18 indicate that this configuration tends to have more grid-noise over steep terrain than in a more complex configuration using CAM, version 6 moist physics \citep[CAM6;][]{}, and is therefore a conservative choice for evaluating any change in grid imprinting between $pg3$ and $pg2$. 

To understand whether the resolved scales of motion are influenced by a coarser resolution physics grid, a suite of aqua-planet simulations \citep{NH2000ASL,MWO2016JAMES} are carried out over a range of spectral-element grid resolutions, using CAM6 physics ($QPC6$ compset). The aqua-planet is an ocean covered planet in perpetual equinox, with fixed, zonally-symmetric sea surface temperatures idealized after present day Earth \citep[$QOBS$ in][]{NH2000ASL}. In CAM, their is no standard for how the physics time-step, $\Delta t_{phys}$, should vary across resolutions, which is complicated by the large sensitivity of solutions to $\Delta t_{phys}$  \citep{WO2003QJR,W2013QJRMS,HR2018JAMES}.

Here, a scaling for $\Delta t_{phys}$ across resolutions is proposed, based on results of the moist bubble test \citep{HR2018JAMES} using CAM-SE-CSLAM and detailed in Appendix~\ref{app:dt}. The basis for the scaling is to alleviate truncation errors that arise in the moist bubble test when $\Delta t_{phys}$ is too large. The scaling is linear in grid-spacing,
\begin{equation}
\Delta t_{phys} = \Delta t_{phys,0} \times \frac{N_e}{N_{e,0}}~s,\label{eq:dt-scale}
\end{equation}
where $\Delta t_{phys,0}$ is taken to be the standard $1800 s$ used in CAM-SE-CSLAM at low resolution, $N_{e,0} = 30$ (equivalent to a dynamics grid-spacing of $111.2km$). $N_e$ refers to the horizontal resolution of the grid; each of the six panels of the cubed-sphere are divided into $N_e \times N_e$ elements. Throughout the paper, spectral-element grid resolutions are denoted by an $ne$ followed by the quantity $N_e$, e.g., $ne30$.

The only other parameters varied across resolutions are the dynamics time-step, $\Delta t_{dyn}$, and explicit numerical dissipation. $\Delta t_{dyn}$ is set according to the CFL criterion. The spectral element method is not implicitly diffusive, so fourth-order hyper-viscosity operators are applied to the state to suppress numerical aritfacts. The scaling of the hyper-viscosity coefficients, $\nu$, across resolutions is defined as,
\begin{align}
\nu_T = \nu_{vor} &= 0.30\times \left(\frac{30}{N_e}1.1\times 10^5\right)^3\, \frac{m^4}{s}, \\
\nu_p = \nu_{div} &= 0.751\times \left(\frac{30}{N_e}1.1\times 10^5\right)^3\, \frac{m^4}{s},
\label{eq:hypervis}
\end{align}
where subscripts $T,~vor,~p,~div$ refer to state variables the operators are applied to, temperature, vorticity, pressure and divergence, respectively. No explicit dissipation of moisture is required since the semi-Lagrangian numerics in CSLAM are diffusive.

\section{Results}\label{sec:results}

\subsection{Held-Suarez with Topography}\label{sec:hs94}

Flow over topography can result in significant grid imprinting using the spectral element method \citep[][HL18]{gmdd-8-4623-2015}. Figure \ref{fig:fhs-contours} shows the results of the Held-Suarez with topography simulations. The middle panel is the vertical pressure velocity, $\omega$, averaged over two years, over the Andes and Himalayan region at two different levels in the mid-troposphere, using the $ne30pg3$ grid. The fields are displayed as a raster plot on the physics grid, so that individual extrema, which characterize the flow over the Andes between about $10^\circ-20^\circ$ S, and the Himalayas between $20^\circ-30^\circ$ N, may be identified as spurious. 

\begin{figure}[t]
\begin{center}
\noindent\includegraphics[width=30pc,angle=0]{figs/fhstopo_ne30pg2-v-ne30pg3-v-10Xnudiv.pdf}\\
\end{center}
\caption{Mean $\omega$ at two model levels in the middle troposphere, in a Held-Suarez configuration outfitted with real world topography. (Left) $ne30pg2$ (Middle) $ne30pg3$ and (Right) $ne30pg3$ with the divergence damping coefficient increased by an order of magnitude. The $\omega$ fields are computed a two-year simulation. The data are presented on a raster plot in order to identify individual grid cells}
\label{fig:fhs-contours}
\end{figure}

As discussed in HL18, grid imprinting over mountainous terrain tends to occur in regions of weak gravitational stability, causing extrema to extend through the full depth of the troposphere as resolved updrafts and downdrafts. Thus, grid imprinting over mountains may be alleviated through increasing the divergence damping in the model. Figure \ref{fig:fhs-contours} (right panel) repeats the $ne30pg3$ simulation through increasing $\nu_{div}$ by an order of magnitude. The spurious noise over the Andes and the Himalayas are damped, and grid point extrema tend to diffuse into neighboring grid cells. The wavenumber-power spectrum of the kinetic energy due to divergent flow (Figure \ref{fig:fhs-div}) confirms that divergent modes are damped at higher wavenumbers (greater then 30), by about an order of magnitude relative to the default $ne30pg3$ simulation.

\begin{figure}[t]
\begin{center}
\noindent\includegraphics[width=25pc,angle=0]{figs/fhstopo_Divergence_ne30pg2-v-ne30pg3-v-10Xnudiv.pdf}\\
\end{center}
\caption{Kinetic energy power spectrum arising from divergent modes in $ne30pg3$, $ne30pg2$ and $ne30pg3$ with the divergence damping coefficient increased by an order of magnitude, in the Held-Suarez with topography simulations. Spectra computed from five months of six-hourly winds.}
\label{fig:fhs-div}
\end{figure}

The $\omega$ field of the $ne30pg2$ simulation is provided in Figure \ref{fig:fhs-contours} (left panel). Grid cell extrema over the Andes is less prevalent than in the $ne30pg3$ simulation, as seen by the reduction in large magnitude $\omega$ (e.g., red grid cells). The spurious oscillations at the foot of the Himalayas appear to have been entirely eliminated. This improvement in grid imprinting is due to the consistent numerical properties of the control volumes in the $pg2$ grid compared with the $pg3$ grid discussed in Section \ref{sec:intro}, and the results are consistent with out hypothesis. The divergent modes are marginally damped relative to $ne30pg3$ for wavenumbers greater than about 50, but are an order of magnitude larger than in the enhanced divergence damping $ne30pg3$ run (Figure \ref{fig:fhs-div}).

\subsection{Aqua-planets}\label{sec:aquaplanet}

Tropical regions are very sensitive to horizontal resolution, primarily due to the scale dependence of resolved updrafts and downdrafts at hydrostatic scales \citep{HR2017JCLIM,HR2018JAMES}. The resolved updrafts have a characteristic length scale associated with them, which in CAM-SE are in the range of five to ten times the grid-spacing, so this length scale changes with model resolution \citep{HR2018JAMES}. This length scale is similar to the effective resolution, which is the characteristic length scale below which the solution is contaminated by numerical dissipation, and the features are overly damped. The effective resolution may be inferred from kinetic energy spectra as the wavenumber where the slope of the spectrum becomes steeper than the observationally determined slope \citep{S2011LNCSE}. In the CESM2 release of CAM-SE, this criterion occurs near wavenumber 60 \citep[see Figure 6 in][]{LetAl2018JAMES}, a length scale of about 6 times the grid spacing and therefore similar to the scale of the updrafts.

The resolution sensitivity of updrafts and downdrafts is related to the length scale of the buoyancy the grid is able to support. A scale analysis of the Poisson equation \citep{JR2016QJRMS} modified for hydrostatic scales shows that the ratio of the scale of $\omega$ at two resolutions, due to their respective buoyancies is,
\begin{equation}
\frac{\omega_{\Delta x_1}}{\omega_{\Delta x_2}} =  \frac{D_{\Delta x_2}}{D_{\Delta x_1}}~,\label{eq:w-scale}
\end{equation}
where $D_{\Delta x}$ is the characteristic buoyancy length scale for grid-spacing $\Delta x$, and it is presumed that the magnitude of the buoyancy and the vertical scale of the buoyancy is unchanged or compensating across the two resolutions. This relationship is robust in a simple moist bubble configuration in CAM-SE and CAM-FV \citep[Finite Volume dynamical core;][]{HR2018JAMES} and CAM-SE-CSLAM (Appendix~\ref{app:dt}), even though the scaling is derived from the dry anelastic equations.

When the physics and dynamics grids have different resolutions, which grid determines the models characteristic $D_{\Delta x}$? The remainder of section~\ref{sec:results} attempts to addresses this question using spectral element grids at low resolution (Section~\ref{sec:lores}), high resolution (Section~\ref{sec:hires}) and across all resolutions typical of present day General Circulation Models (Section~\ref{sec:allres}).

\subsubsection{Low Resolution}\label{sec:lores}

The question posed above may be addressed through comparing $ne30pg2$, where $\Delta x_{phys} = 166.8km$, $\frac{3}{2}$ times larger than the dynamics grid spacing, $\Delta x_{dyn} = 111.2km$, to a simulation where both are equal to the physics grid resolution, $\Delta x_{dyn} = \Delta x_{phys} = 166.8 km$ ($ne20pg3$), and another simulation where both are equal to the dynamics resolution, $\Delta x_{dyn} = \Delta x_{phys} = 111.2 km$ ($ne30pg3$). The resolvable scales in the $ne30pg2$ solution are expected to be bounded by the $ne20pg3$ and $ne30pg3$ solutions. Although according to equation~\ref{eq:dt-scale}, $\Delta t_{phys}$ for $ne20$ grids should be different from $ne30$ grids, here it is set to the $ne30$ value (see Table~\ref{table:grids-lo}) in order to reduce the differences between the three configurations, and justified because lower resolution runs aren't very sensitive to $\Delta t_{phys}$ (Figure~\ref{fig:pdf-dtphys}).

 \begin{table}
 \caption{$\Delta x$ and $\Delta t$ for the physics and dynamics in the low resolution simulations}
 \centering
 \begin{tabular}{llcccc}
 \hline
 Grid name & $\Delta x_{dyn}$  & $\Delta t_{dyn}$ & $\Delta x_{phys}$  & $\Delta t_{phys}$ \\
 \hline
   {\tt{ne}}20{\tt{pg3}}  & 166.8km & 300s  & 166.8km & 1800s \\
   {\tt{ne}}30{\tt{pg2}}  & 111.2km & 300s  & 166.8km & 1800s \\
   {\tt{ne}}30{\tt{pg3}}  & 111.2km & 300s  & 111.2km & 1800s \\
 \hline
 \end{tabular}
 \label{table:grids-lo}
 \end{table}

Figure~\ref{fig:transx} shows a snapshot of the $\omega$ field in the Inter-Tropical Convergence Zone (ITCZ) in the pressure-longitude plane, in the three simulations. The $\omega$ field is overlain with the $\pm 15 K/day$ contour of the physics temperature tendencies (black), which are primarily due to stratiform cloud formation. Since the component of $\omega$ due to buoyancy is determined by the physics temperature tendencies mapped to the GLL grid, the tendencies and $\omega$ are shown on the $GLL$ grid, $f_T^{(gll)}$ and $\omega_{gll}$, respectively. The white contour is intended to outline regions where the deep convection scheme is fairly active, set to the $0.0075 kg/m^2/s$ value of the convective mass fluxes (note the convective mass fluxes have not been mapped to the $GLL$ grid, and so are shown on the $pg$ grid). The figure indicates that large regions of the ITCZ are comprised of upward $\omega$ that balance the warming due to compensating subsidence in the deep convection scheme. Much larger magnitude $\omega$ are comprised of resolved updrafts driven by the buoyancy of stratiform clouds, and resolved downdrafts due to evaporation of condensates produced by overlying clouds \citep{HR2018JAMES}. These large buoyancy stratiform clouds tend to form in the middle-to-upper troposphere due to detrainment of moisture by the deep convection scheme \citep{ZM1995AO}. 

\begin{figure}[t]
\begin{center}
\noindent\includegraphics[width=30pc,angle=0]{figs/panel_transGLL.pdf}\\
\end{center}
\caption{}
\label{fig:transx}
\end{figure}

It is not obvious from Figure~\ref{fig:transx} whether the characteristic length scale of the stratiform clouds, taken here to be $D_{\Delta x}$, is any different across the three simulations. Analogous to determining the effective resolution \citep{S2011LNCSE}, $D_{\Delta x}$ may be inferred from the wave-number power spectrum of $f_T^{(gll)}$ as the maximum wavenumber prior to the steep, un-physical decline in power that characterizes the near-grid scale. The wave-number power spectrum of $f_T^{(gll)}$ in the middle-to-upper troposphere is shown in Figure~\ref{fig:pgXpanel-lores}a. The slope of the $ne20pg3$ spectrum begins to steepen at smaller wavenumbers than in the $ne30pg3$ spectra. Additionally, the $ne30pg2$ spectra is remarkably similar to the $ne30pg3$ spectra, at high wavenumbers. These spectra indicate that $D_{ne30pg2}$ and $D_{ne30pg3}$ are similar, and that both are less than $D_{ne20pg3}$. From equation~\ref{eq:w-scale}, it is expected that the magnitude of the vertical motion is larger in the $ne30pg2$ and $ne30pg3$ simulations.

\begin{figure}[t]
\begin{center}
\noindent\includegraphics[width=30pc,angle=0]{figs/panel_ne20pg2-ne30pg2-ne30pg3.pdf}\\
\end{center}
\caption{(Left) Wavenumber-power spectrum of the temperature tendencies from the moist physics, near the 369 hPa level, (Middle) probability density distribution and (Right) the scaled probability density distribution of upward $\omega$ everywhere in the model. The scaled distributions are scaled to $ne30pg3$ using $\Delta x_{phys}$.}
\label{fig:pgXpanel-lores}
\end{figure}

The probability density function (PDF) of upward $\omega_{gll}$ everywhere in the simulations is shown in Figure~\ref{fig:pgXpanel-lores}b. Larger magnitude $\omega_{gll}$ are more frequent in the $ne30pg2$ run, compared to $ne20pg3$, and the PDF is actually more similar to the $ne30pg3$ distribution, consistent with their $f_T^{(gll)}$ spectrums. This may be further illustrated through scaling the PDF's,
\begin{equation}
P(\omega_{s}) = \alpha \times P(\omega/\alpha),\label{eq:pdf}
\end{equation}
where $P(\omega_{s})$ is the PDF of the scaled $\omega$, $\omega_{s}$, and $\alpha$ is the ratio of $\omega$ to $\omega$ of the target grid resolution. If one assumes that $D_{\Delta x}$ is linear in $\Delta x$, then from equation~\ref{eq:w-scale}, $\alpha = \Delta x_{target}/\Delta x$, where $\Delta x_{target}$ is the grid spacing of the target resolution. The target resolution is taken here to be $\Delta x$ of the $ne30pg3$ grid. 

If $D_{ne30pg2}$ is in fact determined by $\Delta x_{phys}$, then one sets $\Delta x = \Delta x_{phys}$ in $\alpha$. This scaled PDF, however, severely overestimates the frequency of upward $\omega$ in $ne30pg3$ (Figure~\ref{fig:pgXpanel-lores}c). It is clear from the similarity of the un-scaled PDF's and the $f_T^{(gll)}$ spectra that $D_{ne30pg2}$ is determined by $\Delta x_{dyn}$. In contrast, the scaled $ne20pg3$ PDF agree's quite well with the $ne30pg3$ distribution, suggesting that the scale parameter $\alpha$ explains the difference in vertical motion between the two simulations, and that $D_{ne20pg3}$ is a factor $\frac{3}{2}$ times larger than $D_{ne30pg3}$.

There are two reasons $D_{ne30pg2}$ is determined by the $GLL$ grid, and not the $pg$ grid. The first being that the hyper-viscosity coefficients are a function of $\Delta x_{dyn}$ (equation~\ref{eq:hypervis}). The fourth-order hyperviscosity is very scale selective, targeting near grid-scale features more so than, e.g., a second-order operator. The difference in $\Delta x_{phys}$ between $pg2$ and $pg3$ are small enough that the hyperviscosity operators render this distinction somewhat ambiguous, and $D_{\Delta_x}$ is not all that sensitive to the coarser physics. Through increasing $\nu$ in $ne30pg2$ to $ne20$ values, the $f_T^{(gll)}$ spectrum steepens at lower wavenumbers compared with the standard $ne30pg2$ run, although this range is still above the range of wavenumbers that the $ne20pg3$ spectrum begins to steepen (not shown).

The other reason $D_{\Delta x}$ is determined by $\Delta x_{dyn}$, is that high-order mapping of the physics tendencies from $pg2$ to the $GLL$ and $CSLAM$ grids helps reconstruct scales that are not supported on the $pg2$ grid. The left panel of Figure~\ref{fig:loworder}a shows a close-up of the wavenumber power spectrum of the physics temperature tendencies on the $pg$ grid ($f_T^{(pg)}$: dotted) and on the $GLL$ grid (solid). In $ne30pg3$, the magnitudes are similar on both grids, except the mapping tends to damp the high wavenumbers of $f_T^{(gll)}$  (larger than 65) compared with $f_T^{(pg)}$. For $ne30pg2$, the magnitude is $f_T^{(gll)}$ is actually larger than $f_T^{(pg)}$, and similar to $f_T^{(gll)}$ of the $ne30pg3$ grid, mentioned earlier in reference to Figure~\ref{fig:pgXpanel-lores}a. The high-order mapping can therefore replicate the scales of the physics tendencies that occur in the $pg3$ simulation, even though the physics are evaluated on a coarser $pg2$ grid.

Figure~\ref{fig:loworder}a also shows a $ne30pg2$ simulation, but using low-order mapping, i.e., piecewise constant mapping from $pg2$ to $CSLAM$ and bilinear mapping from $pg2$ to $GLL$.  The magnitude of $f_T^{(gll)}$ is now similar to $f_T^{(pg)}$, and even slightly less at high wavenumbers greater than 60. A close up of the PDF of $\omega_{gll}$ is provided in Figure~\ref{fig:loworder}b. Following suit, the frequency of large magnitude $\omega_{gll}$ in the low-order run is less compared to the default $ne30pg2$ simulation (Figure~\ref{fig:loworder}, right panel). 

The dotted lines in Figure~\ref{fig:loworder}b show the PDF of $\omega$ on the $pg$ grids. The frequency of large magnitude $\omega$ is reduced on the $pg$ grids, compared with the $GLL$ grids. This is primarily due to integrating the nodal point values over control volumes (HL18). The larger $\omega$ values are even less frequent on the $pg2$ grid due to integrating over control volumes $\frac{9}{4}$ times greater than the $pg3$ control volumes.

Through using the low-order mapping in $ne30pg2$, and by increasing $\nu$ to $ne20$ values, the simulation more closely resembles the $ne20pg3$ run (Figure~\ref{fig:pgXpanel-lores}). In this case, $D_{\Delta_x}$ is more accurately determined by $\Delta x_{phys}$, since the scaled PDF matches the $ne30pg3$ simulation quite well. Therefore, at low resolution, our default $ne30pg2$ configuration does not indicate that the scales of motion are aliased to the resolution of the coarser resolution physics grid, as they more closely resemble the $ne30pg3$ solution.

\begin{figure}[t]
\begin{center}
\noindent\includegraphics[width=30pc,angle=0]{figs/panel_loworder.pdf}\\
\end{center}
\caption{(Left) Wavenumber-power spectrum of the temperature tendencies from the moist physics, near the 369 hPa level, and (right) probability density distribution of upward $\omega$, everywhere in the model, for three year-long aqua-planet simulations.  Solid lines refer to values of on the dynamics grid, and dashed lines, the values on the physics grid. See text for details regarding the three simulations.}
\label{fig:loworder}
\end{figure}

\subsubsection{High Resolution}\label{sec:hires}

 \begin{table}
 \caption{$\Delta x$ and $\Delta t$ for the physics and dynamics in the high resolution simulations}
 \centering
 \begin{tabular}{llcccc}
 \hline
 Grid name & $\Delta x_{dyn}$  & $\Delta t_{dyn}$ & $\Delta x_{phys}$  & $\Delta t_{phys}$ \\
 \hline
   {\tt{ne}}80{\tt{pg3}}  & 41.7km & 112.5s  & 41.7km & 625s \\
   {\tt{ne}}120{\tt{pg2}}  & 27.8km & 75s  & 41.7km & 450s \\
   {\tt{ne}}120{\tt{pg3}}  & 27.8km & 75s  & 27.8km & 450s \\
 \hline
 \end{tabular}
 \label{table:grids-hi}
 \end{table}

\begin{figure}[t]
\begin{center}
\noindent\includegraphics[width=30pc,angle=0]{figs/panel_ne80pg3_ne120pg2_ne120pg3.pdf}\\
\end{center}
\caption{As in Figure~\ref{fig:pgXpanel-lores}, but for the high resolution simulations. Asterisks indicate that the physics time-step in these simulations are $\Delta t_{phys} = 675 s$, which is larger than those used in the default $ne120$ grid of $\Delta t_{phys} = 450 s$ (see Table \ref{table:grids2}).}
\label{fig:pgXpanel-hires}
\end{figure}

\subsubsection{Across Resolutions}\label{sec:allres}

\begin{figure}[t]
\begin{center}
\noindent\includegraphics[width=30pc,angle=0]{figs/panel_diags.pdf}\\
\end{center}
\caption{Year long mean values, averaged over +/-$10^{\circ}$ latitude.}
\label{fig:diags}
\end{figure}


%\cite{HR2017JCLIM} has shown that through assuming the horizontal scale of the Archimedean buoyancy is linearly proportional to the grid spacing, the magnitude of the vertical motion in aqua-planet runs did not scale like the inverse of the grid-spacing across a set of grid resolutions. However, the results of \cite{HR2018JAMES} indicate that the scaling may be recovered through a more judicous choice of $\Delta t_{phys}$ (Table \ref{table:grids}). To test this idea, three aqua-planet simulations are carried out using the $ne30pg3$, $ne60pg3$ and $ne120pg3$ grids. 

%Figure \ref{fig:pg3panel}a shows the wavenumber-power spectrum of the moist physics temperature tendencies (referred to as {\em{forcing}} throughout this study) in the upper troposphere, where statiform heating is common due to detrainment by the deep-convection scheme \citep{ZM1995AO}. There is a clear reduction in forcing scale with resolution, which is consistent with the increased magnitude of $\omega$ with resolution, expressed by the probability density distribution (PDF) of upward $\omega$, everywhere in the model (Figure \ref{fig:pg3panel}b). The PDFs may be scaled to the $ne120pg3$ grid using the scaling of \cite{PG2006JAS}, 
%\begin{equation}
%P(\omega_{s}) = \alpha \times P(\omega/\alpha),\label{eq:pdf}
%\end{equation}
%where $P(\omega_{s})$ is the PDF of the scaled $\omega$, $\omega_{s}$, and $\alpha$ is the ratio of the vertical velocity scale to the vertical velocity scale of the target grid resolution, set to $\alpha = \Delta x_{target}/\Delta x$, after \citep{HR2018JAMES}, where $\Delta x$ is the grid spacing and $\Delta x_{target}$ is the grid spacing of the target resolution. The scaled PDFs do not line up perfectly on top one another (Figure \ref{fig:pg3panel}c), but the scaling explains the change in magnitude of $\omega$ with resolution to first order. This result is consistent with the notion that the characteristic forcing scales in the simulations are linearly proportional to the grid spacing.

%When the physics and dynamics grids are of a different resolution, it is not clear which grid determines the resolved scales of motion. forcing scale. If the characteristic forcing scale is determined by the physics grid spacing, $\Delta x_{phys}$, than the $ne30pg2$ solution should more closely resemble the $ne20pg3$ solution, in which both the physics and dynamics grids are equal to the physics grid of $ne30pg2$. Likewise, if the dynamics grid spacing, $\Delta x_{dyn}$, governs the forcing scale than the $ne30pg2$ solution would more closely resemble the $ne30pg3$ solution. Figure \ref{fig:pg2panel}a is the PDF of upward $\omega$ for simluations using the $ne20pg3$, $ne30pg2$ and $ne30pg3$ grids. It is clear that the $ne30pg2$ solution more closely resembles the $ne30pg3$ solution. Scaling the $ne20pg3$ solution to $ne30pg3$ using eqn. \ref{eq:pdf} does a fair job of predicting the $ne30pg3$ magnitudes (Figure \ref{fig:pg2panel}b), again consistent with a linear relation between forcing scale and grid spacing. Scaling the $ne30pg2$ PDF to the $ne30pg3$ grid using $\Delta x_{phys}$ overestimates the magnitude of $\omega$ in the $ne30pg3$ solution, suggesting the characteristic forcing scale can not be proportional to $\Delta x_{phys}$. 

%The dynamical core requires explicit numerical damping to increase with $\Delta x_{dyn}$ for numerical stability, the exact relation provided in the appendix of \cite{LetAl2018JAMES}. The hyper-viscosity coefficients are therefore smaller (and equal) in the $ne30pg2$ and $ne30pg3$ simulations, relative to the $ne20pg3$ simulation. Figure \ref{fig:pg2panel}a (green line) shows the PDF of upward $\omega$ for a $ne30pg2$ simulation, in which the hyper-viscosity coefficients are increased to $ne20pg3$ values (referred to as $ne30pg2-hivisc$). The solution now more closely resembles the $ne20pg3$ solution, indicating that an increase in explicit damping results in an increase in characteristic forcing scale. Through scaling the $ne30pg2-hivisc$ solutions to the $ne30pg3$ grid using $\Delta x_{phys}$, the scaled solution lie much closer to the $ne30pg3$ solution, compared wth scaling the default $ne30pg2$ solution using $\Delta x_{phys}$. When using a slightly lower resolution physics grid, $\Delta x_{phys}/\Delta x_{dyn} = 1.5$, it seems the forcing scale is determined by $\Delta x_{dyn}$, primarily a result of $\Delta x_{dyn}$ dependent hyper-viscous damping.

%The vertical velocity scale is determined by the characteristic forcing scale on the dynamical core grid. Mapping the physics forcing to the dynamics grid using a high-order reconstruction may introduce some fine scale features that the physics grid is unable to support, potentially increasing the vertical velocity scale. A $ne30pg2$ simulation using low-order reconstruction (bilinear interpolation from $pg2$ to $GLL$, and piecewise-constant mapping between $pg2$ and $CSLAM$ grids; referred to as $ne30pg2-loworder$) is carried out. The wavenumber-power spectrum of the physics forcing in the upper-troposphere on the physics grid (Figure \ref{fig:loworder}a), and after the forcing is mapped to the dynamics grid (Figure \ref{fig:loworder}b) is provided for the $ne30pg2-loworder$, $ne30pg2$ and $ne30pg3$ simulations. 

%On the physics grid, power at high wavenumbers is reduced in $ne30pg2-loworder$ compared with the default $ne30pg2$ solution, and both have less power than the $ne30pg3$ solution at most wavenumbers. On the dynamics grid, $ne30pg2-loworder$ is the only solution with a clear reduction in power compared with $ne30pg3$ \textemdash the power spectrum of the $ne30pg2$ simulation is indistinguishable from the $ne30pg3$ solution at high wavenumbers (but note the damped oscillations in the $10-20$ wavenumber window in $ne30pg2$). The PDFs of upward $\omega$ indicate the magnitude of the $ne30pg2$ solution lies intermediate to the two other simulations, but the magnitudes are closer to the $ne30pg3$ solution in the higher probability regions (greater than -2 hPa/day). High-order mapping is therefore an effective means to mitigate any loss in effective resolution arising from the use of a coarser physics grid.

% \begin{table}
%\caption{Average equatorial grid spacing, $\Delta x$, and model time-step, $\Delta x$, used by the physical parameterizations, $phys$, and dynamical core, $dyn$.}
% \centering
%\begin{tabular}{llcccc}
%\hline
%Grid name & $\Delta x_{dyn}$  & $\Delta t_{dyn}$ & $\Delta x_{phys}$  & $\Delta t_{phys}$ \\
%\hline
% {\tt{ne}}40{\tt{pg3}}  &  83.4km & 150s  &  83.4km &  900s \\
% {\tt{ne}}60{\tt{pg2}}  &  55.6km & 150s  &  83.4km &  900s \\
%   {\tt{ne}}60{\tt{pg3}}  &  55.6km & 150s  &  55.6km &  900s \\
%   {\tt{ne}}80{\tt{pg3}}  &  41.7km &  75s  &  41.7km &  450s \\
%  {\tt{ne}}120{\tt{pg2}} &  27.8km &  75s  &  41.7km &  450s \\
%   {\tt{ne}}120{\tt{pg3}} &  27.8km &  75s  &  27.8km &  450s \\
%\hline
%\multicolumn{2}{l}{$^{a}$Footnote text here.}
%\end{tabular}
%\label{table:grids2}
%\end{table}

\section{Conclusions}\label{sec:conclusions}

Mitigating grid-imprinting through increasing the divergence damping coefficient an order of magnitude greater than is required for numerical stability is not ideal from a model development perspective. The hyper-viscosity coefficients are one of the only a handful of free-parameters in CAM-SE to tune the kinetic energy spectrum to match observations \citep{SPKS2014JAS,LetAl2018JAMES}. 

%%

%  Numbered lines in equations:
%  To add line numbers to lines in equations,
%  \begin{linenomath*}
%  \begin{equation}
%  \end{equation}
%  \end{linenomath*}

%%% End of body of article

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Optional Appendix goes here
%
% The \appendix command resets counters and redefines section heads
%
% After typing \appendix
%
% will show
% A: Here Is Appendix Title
%
\appendix
\section{Defining $\Delta t_{phys}$ across resolutions}\label{app:dt}
 \cite{HR2018JAMES} developed a moist bubble test, which indicate that time-truncation errors are large at high resolution (roughly $50km$ and less), and may provide incite on a reasonable scaling of $\Delta t_{phys}$ across resolutions in more complex configurations. In the test a set of non-rotating simulations are initialized with a super-saturated thermal bubble, and the grid spacing and bubble radius are simultaneously reduced by the same factor in each run through varying the planetary radius. The test was designed to mimic the reduction in buoyancy length scales that occur when the model resolution is increased in more complex configurations \citep{HETAL2006JCLIM,HR2018JAMES}. 
 
The moist bubble test is performed with CAM-SE-CSLAM and coupled to the simple condensation routine of \cite{K1969MM} across five different resolutions (pertaining to the $ne30$, $ne40$, $ne60$, $ne80$, and $ne120$ grids). The results are expressed as the minimum $\omega$ throughout each one day simulation, and shown in Figure~\ref{fig:bubble}. Two sets of simulations are performed with both $pg3$ and $pg2$, one with $\Delta t_{phys}$ determined by equation~\ref{eq:dt-scale}, and an equivalent set of simulations with $\Delta t_{phys} = \Delta t_{phys,0}$ for all resolutions. 

\begin{figure}[t]
\begin{center}
\noindent\includegraphics[width=25pc,angle=0]{figs/bubble_test.pdf}\\
\caption{The magnitude of $\omega$ in the $pg3$ solutions are systematically larger than the $pg2$ solutions, which is primarily a result of the damping effect of integrating the basis functions over a larger control volume.}
\end{center}
\caption{}
\label{fig:bubble}
\end{figure}

Since the diameters of the bubbles, $D$, are set proportional to $\Delta x_{dyn}$, \cite{HR2018JAMES} has shown that $\omega$ converges to the scaling of equation~\ref{eq:w-scale} in the limit of small $\Delta t_{phys}$, where small $\Delta t_{phys}$ is defined as $\Delta t_{phys}$ = $\Delta t_{dyn}$, where $\Delta t_{dyn}$ is the CFL limiting time-step. Equation~\ref{eq:w-scale} is overlain as grey lines in Figure~\ref{fig:bubble}, with $ne30$ being the reference resolution. The solutions using $\Delta t_{phys}$ from equation~\ref{eq:dt-scale} follow the scaling, whereas fixing $\Delta t_{phys} = 1800s$ across resolutions damps the solution relative to the analytical solution, progressively more so at higher resolutions. If $\Delta t_{phys}$ is too large, the solution has non-negligible error, which is avoided through scaling $\Delta t_{phys}$ according to equation~\ref{eq:dt-scale}.

It is not clear if the results of the idealized test extend to the results of more complex configurations. To get a a handle on whether the test is useful for understanding more realistic configurations, four aqua-planet simulations are performed with CAM6 physics. A pair of $ne30pg2$ simulations, one in which $\Delta t_{phys}$ is set to the appropriate value from equation~\ref{eq:dt-scale} ($1800s$), and one where it is set to the $\Delta t_{phys}$ corresponding to the $ne20$ resolution ($2700s$). Similarly, a pair of $ne120pg2$ simulations are performed, one with $\Delta t_{phys}$ set to the value from equation~\ref{eq:dt-scale} ($450s$), one with $\Delta t_{phys}$ set to the $ne80$ value ($625s$). 

\begin{figure}[t]
\begin{center}
\noindent\includegraphics[width=30pc,angle=0]{figs/panel_pdf_dtphys.pdf}\\
\end{center}
\caption{Probability density distribution of upward $\omega$ everywhere in the model in the aqua-planets using the $ne30pg2$ grid (Left) and the $ne120pg2$ grid (Right). Figure computed for one year of 6-hourly data. The different colors indicate the physics time-steps used in the runs.}
\label{fig:pdf-dtphys}
\end{figure}

Figure~\ref{fig:pdf-dtphys} shows the PDFs of $\omega$ from a year of six-hourly data in the simulations. At lower resolution, $\Delta t_{phys}$ has only a very small effect on the solution, near the tale-end of the distributions (Figure~\ref{fig:pdf-dtphys}a). At high-resolution, values of $\omega$ less then about $3 Pa/s$ are more frequent in the small $\Delta t_{phys}$ run, with the discrepancy growing more for larger magnitudes of $\omega$ (Figure~\ref{fig:pdf-dtphys}b). These results are similar to the aqua-planet results in \cite{HR2018JAMES} using a prior version of CAM physics, version 5, and show that solutions are more sensitive to $\Delta t_{phys}$ at higher-resolution. The progressively larger errors with increasing resolution also manifests in the moist bubble tests, indicating that truncation errors arising from large $\Delta t_{phys}$ do exist in more complex configurations.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%  ACKNOWLEDGMENTS
%
% The acknowledgments must list:
%
% 	All funding sources related to this work from all authors
%
% 	Any real or perceived financial conflicts of interests for any
%	author
%
% 	Other affiliations for any author that may be perceived as
% 	having a conflict of interest with respect to the results of this
% 	paper.
%
% 	A statement that indicates to the reader where the data
% 	supporting the conclusions can be obtained (for example, in the
% 	references, tables, supporting information, and other databases).
%
% It is also the appropriate place to thank colleagues and other contributors. 
% AGU does not normally allow dedications.

%\acknowledgments

%% ------------------------------------------------------------------------ %%
%% Citations

% Please use ONLY \citet and \citep for reference citations.
% DO NOT use other cite commands (e.g., \cite, \citeyear, \nocite, \citealp, etc.).


%% Example \citet and \citep:
%  ...as shown by \citet{Boug10}, \citet{Buiz07}, \citet{Fra10},
%  \citet{Ghel00}, and \citet{Leit74}. 

%  ...as shown by \citep{Boug10}, \citep{Buiz07}, \citep{Fra10},
%  \citep{Ghel00, Leit74}. 

%  ...has been shown \citep [e.g.,][]{Boug10,Buiz07,Fra10}.



%%  REFERENCE LIST AND TEXT CITATIONS
%
% Either type in your references using
%
% \begin{thebibliography}{}
% \bibitem[{\textit{Kobayashi et~al.}}(2003)]{R2013} Kobayashi, T.,
% Tran, A.~H., Nishijo, H., Ono, T., and Matsumoto, G.  (2003).
% Contribution of hippocampal place cell activity to learning and
% formation of goal-directed navigation in rats. \textit{Neuroscience}
% 117, 1025--1035.
%
% \bibitem{}
% Text
% \end{thebibliography}
%
\bibliography{bib}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Or, to use BibTeX:
%
% Follow these steps
%
% 1. Type in \bibliography{<name of your .bib file>} 
%    Run LaTeX on your LaTeX file.
%
% 2. Run BiBTeX on your LaTeX file.
%
% 3. Open the new .bbl file containing the reference list and
%   copy all the contents into your LaTeX file here.
%
% 4. Run LaTeX on your new file which will produce the citations.
%
% AGU does not want a .bib or a .bbl file. Please copy in the contents of your .bbl file here.


%% After you run BibTeX, Copy in the contents of the .bbl file here:


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Track Changes:
% To add words, \added{<word added>}
% To delete words, \deleted{<word deleted>}
% To replace words, \replace{<word to be replaced>}{<replacement word>}
% To explain why change was made: \explain{<explanation>} This will put
% a comment into the right margin.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% At the end of the document, use \listofchanges, which will list the
% changes and the page and line number where the change was made.

% When final version, \listofchanges will not produce anything,
% \added{<word or words>} word will be printed, \deleted{<word or words} will take away the word,
% \replaced{<delete this word>}{<replace with this word>} will print only the replacement word.
%  In the final version, \explain will not print anything.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%
\listofchanges
%%%

\end{document}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Supporting Information
%% (Optional) See AGUSuppInfoSamp.tex/pdf for requirements 
%% for Supporting Information.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

More Information and Advice:

%% ------------------------------------------------------------------------ %%
%
%  SECTION HEADS
%
%% ------------------------------------------------------------------------ %%

% Capitalize the first letter of each word (except for
% prepositions, conjunctions, and articles that are
% three or fewer letters).

% AGU follows standard outline style; therefore, there cannot be a section 1 without
% a section 2, or a section 2.3.1 without a section 2.3.2.
% Please make sure your section numbers are balanced.
% ---------------
% Level 1 head
%
% Use the \section{} command to identify level 1 heads;
% type the appropriate head wording between the curly
% brackets, as shown below.
%
%An example:
%\section{Level 1 Head: Introduction}
%
% ---------------
% Level 2 head
%
% Use the \subsection{} command to identify level 2 heads.
%An example:
%\subsection{Level 2 Head}
%
% ---------------
% Level 3 head
%
% Use the \subsubsection{} command to identify level 3 heads
%An example:
%\subsubsection{Level 3 Head}
%
%---------------
% Level 4 head
%
% Use the \subsubsubsection{} command to identify level 3 heads
% An example:
%\subsubsubsection{Level 4 Head} An example.
%
%% ------------------------------------------------------------------------ %%
%
%  IN-TEXT LISTS
%
%% ------------------------------------------------------------------------ %%
%
% Do not use bulleted lists; enumerated lists are okay.
% \begin{enumerate}
% \item
% \item
% \item
% \end{enumerate}
%
%% ------------------------------------------------------------------------ %%
%
%  EQUATIONS
%
%% ------------------------------------------------------------------------ %%

% Single-line equations are centered.
% Equation arrays will appear left-aligned.

Math coded inside display math mode \[ ...\]
 will not be numbered, e.g.,:
 \[ x^2=y^2 + z^2\]

 Math coded inside \begin{equation} and \end{equation} will
 be automatically numbered, e.g.,:
 \begin{equation}
 x^2=y^2 + z^2
 \end{equation}


% To create multiline equations, use the
% \begin{eqnarray} and \end{eqnarray} environment
% as demonstrated below.
\begin{eqnarray}
  x_{1} & = & (x - x_{0}) \cos \Theta \nonumber \\
        && + (y - y_{0}) \sin \Theta  \nonumber \\
  y_{1} & = & -(x - x_{0}) \sin \Theta \nonumber \\
        && + (y - y_{0}) \cos \Theta.
\end{eqnarray}

%If you don't want an equation number, use the star form:
%\begin{eqnarray*}...\end{eqnarray*}

% Break each line at a sign of operation
% (+, -, etc.) if possible, with the sign of operation
% on the new line.

% Indent second and subsequent lines to align with
% the first character following the equal sign on the
% first line.

% Use an \hspace{} command to insert horizontal space
% into your equation if necessary. Place an appropriate
% unit of measure between the curly braces, e.g.
% \hspace{1in}; you may have to experiment to achieve
% the correct amount of space.


%% ------------------------------------------------------------------------ %%
%
%  EQUATION NUMBERING: COUNTER
%
%% ------------------------------------------------------------------------ %%

% You may change equation numbering by resetting
% the equation counter or by explicitly numbering
% an equation.

% To explicitly number an equation, type \eqnum{}
% (with the desired number between the brackets)
% after the \begin{equation} or \begin{eqnarray}
% command.  The \eqnum{} command will affect only
% the equation it appears with; LaTeX will number
% any equations appearing later in the manuscript
% according to the equation counter.
%

% If you have a multiline equation that needs only
% one equation number, use a \nonumber command in
% front of the double backslashes (\\) as shown in
% the multiline equation above.

% If you are using line numbers, remember to surround
% equations with \begin{linenomath*}...\end{linenomath*}

%  To add line numbers to lines in equations:
%  \begin{linenomath*}
%  \begin{equation}
%  \end{equation}
%  \end{linenomath*}



